// src/sprites.js - Enhanced sprite system with evolution forms
function spriteFromMatrix(mat, fg="#1a3f2a", bg=null){ return {mat, fg, bg}; }
const PIX = (rows, color="#1a3f2a") => spriteFromMatrix(rows.map(r=>r.padEnd(22,"0")), color);

export const SPRITES = {
  // Fallback
  Placeholder: PIX([
    "0000000000000000000000","0000000011111100000000","0000001111111111000000","0000011111111111100000",
    "0000111111111111110000","0001111111111111111000","0001111111111111111000","0001111111111111111000",
    "0001111111111111111000","0001111111111111111000","0001111111111111111000","0001111111111111111000",
    "0001111111111111111000","0001111111111111111000","0000111111111111110000","0000011111111111100000",
    "0000001111111111000000","0000000011111100000000","0000000000000000000000",
  ]),

  // ROSE LINE - Pink/Magenta evolution
  Budmon: PIX([
    "0000000000100000000000","0000000001110000000000","0000000011111000000000","0000000111111100000000",
    "0000000011111000000000","0000000111111100000000","0000001111111110000000","0000011111111111000000",
    "0000011111111111000000","0000001111111110000000","0000000011111000000000","0000000010010000000000",
    "0000000001110000000000","0000000001110000000000","0000000000100000000000",
  ], "#a3134b"),

  Roseling: PIX([
    "0000000001110000000000","0000000011111000000000","0000000111111100000000","0000001111111110000000",
    "0000011111111111000000","0000111111111111100000","0000011111111111000000","0000001111111110000000",
    "0000000011111000000000","0000000101110100000000","0000000001110000000000","0000000010011000000000",
  ], "#b71b58"),

  Rosemon: PIX([
    "0000001111111000000000","0000011111111100000000","0000111111111110000000","0001111111111111000000",
    "0011111111111111100000","0111111111111111110000","1111111111111111111000","1111111111111111111100",
    "1111100111111100111100","1111000111111000111100","0111111111111111111000","0011111111111111100000",
    "0000111111111110000000","0000001111111000000000","0000000111110000000000","0000000011100000000000",
  ], "#d91b73"),

  RosemonMega: PIX([
    "0001111111111111100000","0011111111111111110000","0111111111111111111000","1111111111111111111100",
    "1111111111111111111110","1111111111111111111110","1111111111111111111110","1111111111111111111110",
    "1111001111111111001110","1110001111111111000110","1111111111111111111110","0111111111111111111000",
    "0011111111111111110000","0001111111111111100000","0000111111111110000000","0000001111111000000000",
    "0000000111110000000000","0000000011100000000000",
  ], "#e91b8a"),

  // POWER LINE - Orange/Red evolution  
  Agumon: PIX([
    "0000000001111000000000","0000000111111110000000","0000011111111111000000","0000111111111111100000",
    "0001111110011111110000","0011111100011111111000","0111111111111111111100","1111111111111111111110",
    "1111101111111111011110","1111100111111100011110","0111111111111111111100","0011111111111111111000",
  ], "#ff7700"),

  Greymon: PIX([
    "0000011111111111000000","0001111111111111100000","0011111111111111110000","0111111111111111111000",
    "1111111111111111111100","1111111111111111111110","1111111111111111111110","1111110011111100111110",
    "1111100011111100011110","1111111111111111111110","1111111111111111111110","0111111111111111111000",
    "0011111111111111110000","0001111111111111100000","0000111111111110000000","0000001111111000000000",
  ], "#cc5500"),

  MetalGreymon: PIX([
    "0011111111111111110000","0111111111111111111000","1111111111111111111100","1111111111111111111110",
    "1111111111111111111110","1111111111111111111110","1111110000000000111110","1111100000000000011110",
    "1111110000000000111110","1111111111111111111110","1111111111111111111110","1111111111111111111100",
    "0111111111111111111000","0011111111111111110000","0001111111111111100000","0000111111111110000000",
    "0000001111111000000000","0000000111110000000000",
  ], "#aa3300"),

  WarGreymon: PIX([
    "0111111111111111111000","1111111111111111111100","1111111111111111111110","1111111111111111111110",
    "1111111111111111111110","1111110000000000111110","1111100000000000011110","1111000000000000001110",
    "1111100000000000011110","1111110000000000111110","1111111111111111111110","1111111111111111111110",
    "1111111111111111111110","1111111111111111111100","0111111111111111111000","0011111111111111110000",
    "0001111111111111100000","0000111111111110000000","0000001111111000000000","0000000111110000000000",
  ], "#882200"),

  // TECH LINE - Blue/Purple evolution
  TechAgumon: PIX([
    "0000000001111000000000","0000000111111110000000","0000011111111111000000","0000111111111111100000",
    "0001111110011111110000","0011111100011111111000","0111111111111111111100","1111111111111111111110",
    "1111101111111111011110","1111100111111100011110","0111111111111111111100","0011111111111111111000",
  ], "#0066cc"),

  TechGreymon: PIX([
    "0000011111111111000000","0001111111111111100000","0011111111111111110000","0111111111111111111000",
    "1111111111111111111100","1111111111111111111110","1111111111111111111110","1111110011111100111110",
    "1111100011111100011110","1111111111111111111110","1111111111111111111110","0111111111111111111000",
    "0011111111111111110000","0001111111111111100000","0000111111111110000000","0000001111111000000000",
  ], "#0055aa"),

  MachineGreymon: PIX([
    "0011111111111111110000","0111111111111111111000","1111111111111111111100","1111111111111111111110",
    "1111111111111111111110","1111111111111111111110","1111110000000000111110","1111100000000000011110",
    "1111110000000000111110","1111111111111111111110","1111111111111111111110","1111111111111111111100",
    "0111111111111111111000","0011111111111111110000","0001111111111111100000","0000111111111110000000",
    "0000001111111000000000","0000000111110000000000",
  ], "#004488"),

  CyberGreymon: PIX([
    "0111111111111111111000","1111111111111111111100","1111111111111111111110","1111111111111111111110",
    "1111111111111111111110","1111110000000000111110","1111100000000000011110","1111000000000000001110",
    "1111100000000000011110","1111110000000000111110","1111111111111111111110","1111111111111111111110",
    "1111111111111111111110","1111111111111111111100","0111111111111111111000","0011111111111111110000",
    "0001111111111111100000","0000111111111110000000","0000001111111000000000","0000000111110000000000",
  ], "#003366"),

  // GUARD LINE - Green/Brown evolution
  GuardAgumon: PIX([
    "0000000001111000000000","0000000111111110000000","0000011111111111000000","0000111111111111100000",
    "0001111110011111110000","0011111100011111111000","0111111111111111111100","1111111111111111111110",
    "1111101111111111011110","1111100111111100011110","0111111111111111111100","0011111111111111111000",
  ], "#228833"),

  GuardGreymon: PIX([
    "0000011111111111000000","0001111111111111100000","0011111111111111110000","0111111111111111111000",
    "1111111111111111111100","1111111111111111111110","1111111111111111111110","1111110011111100111110",
    "1111100011111100011110","1111111111111111111110","1111111111111111111110","0111111111111111111000",
    "0011111111111111110000","0001111111111111100000","0000111111111110000000","0000001111111000000000",
  ], "#196622"),

  ShieldGreymon: PIX([
    "0011111111111111110000","0111111111111111111000","1111111111111111111100","1111111111111111111110",
    "1111111111111111111110","1111111111111111111110","1111110000000000111110","1111100000000000011110",
    "1111110000000000111110","1111111111111111111110","1111111111111111111110","1111111111111111111100",
    "0111111111111111111000","0011111111111111110000","0001111111111111100000","0000111111111110000000",
    "0000001111111000000000","0000000111110000000000",
  ], "#115511"),

  FortressGreymon: PIX([
    "0111111111111111111000","1111111111111111111100","1111111111111111111110","1111111111111111111110",
    "1111111111111111111110","1111110000000000111110","1111100000000000011110","1111000000000000001110",
    "1111100000000000011110","1111110000000000111110","1111111111111111111110","1111111111111111111110",
    "1111111111111111111110","1111111111111111111100","0111111111111111111000","0011111111111111110000",
    "0001111111111111100000","0000111111111110000000","0000001111111000000000","0000000111110000000000",
  ], "#0a440a"),
};

export function drawSprite(ctx, name, size=72){
  const spr = SPRITES[name] || SPRITES.Placeholder;
  const scale = Math.floor(size / 22);
  ctx.clearRect(0,0,size,size);
  for(let y=0;y<spr.mat.length;y++){
    const row=spr.mat[y];
    for(let x=0;x<row.length;x++){
      if(row[x]==='1'){ 
        ctx.fillStyle=spr.fg; 
        ctx.fillRect(x*scale,y*scale,scale,scale); 
      }
      else if(spr.bg){ 
        ctx.fillStyle=spr.bg; 
        ctx.fillRect(x*scale,y*scale,scale,scale); 
      }
    }
  }
}

// Helper function to get sprite name based on line and level
export function getSpriteForLineAndLevel(line, level) {
  const stageNames = {
    ROSE: ['Budmon', 'Roseling', 'Rosemon', 'Rosemon', 'RosemonMega', 'RosemonMega'],
    POWER: ['Agumon', 'Greymon', 'MetalGreymon', 'MetalGreymon', 'WarGreymon', 'WarGreymon'],
    TECH: ['TechAgumon', 'TechGreymon', 'MachineGreymon', 'MachineGreymon', 'CyberGreymon', 'CyberGreymon'],
    GUARD: ['GuardAgumon', 'GuardGreymon', 'ShieldGreymon', 'ShieldGreymon', 'FortressGreymon', 'FortressGreymon']
  };
  
  const chain = stageNames[line] || stageNames.POWER;
  const index = Math.min(Math.max(0, level - 1), chain.length - 1);
  return chain[index];
}
